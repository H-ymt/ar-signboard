# MindAR ターゲット画像作成ガイド

**作成日**: 2025年10月15日

このガイドでは、AR看板アプリで使用するMindARターゲット画像の作成方法を詳しく説明します。

---

## 📋 目次

1. [ターゲット画像とは](#ターゲット画像とは)
2. [良いターゲット画像の条件](#良いターゲット画像の条件)
3. [ターゲット画像の作成手順](#ターゲット画像の作成手順)
4. [コンパイル方法](#コンパイル方法)
5. [トラブルシューティング](#トラブルシューティング)

---

## ターゲット画像とは

**ターゲット画像**は、ARアプリがカメラ映像の中から認識する基準となる画像です。

- MindARは画像認識型ARライブラリで、事前に登録したターゲット画像を検出します
- ターゲット画像を検出すると、その位置にAR看板を重ねて表示します
- ターゲット画像は印刷して使用することを想定しています

### ファイル形式

- **入力**: `.jpg`, `.png` (オリジナル画像)
- **出力**: `.mind` (MindAR専用のコンパイル済みファイル)

---

## 良いターゲット画像の条件

MindARが正確に認識するには、特徴点が豊富な画像が必要です。

### ✅ 推奨される特徴

| 特徴 | 説明 | 例 |
|------|------|------|
| **高コントラスト** | 明暗の差がはっきりしている | 白黒のロゴ、カラフルなイラスト |
| **豊富な特徴点** | エッジ、角、テクスチャが多い | 複雑な絵柄、写真 |
| **ユニークなパターン** | 他と区別しやすいデザイン | 企業ロゴ、アートワーク |
| **非対称性** | 上下左右で異なる | 特定の向きを持つデザイン |
| **適度なサイズ** | 512x512px ~ 1024x1024px | 正方形推奨 |

### ❌ 避けるべき特徴

| 特徴 | 理由 | 例 |
|------|------|------|
| **単色** | 特徴点が検出できない | 無地の背景、単一色の面 |
| **繰り返しパターン** | 位置を特定できない | グリッド、ストライプ |
| **低コントラスト** | 検出精度が低下 | ぼやけた画像、淡い色 |
| **光沢面** | 反射で認識が不安定 | 鏡面仕上げ、光沢紙 |
| **過度に複雑** | 処理負荷が高い | 超高解像度の写真 |

### 🎯 おすすめのターゲット画像例

以下のような画像が良いターゲットになります：

1. **企業ロゴ・ブランドロゴ**
   - 特徴的なデザイン
   - はっきりしたコントラスト

2. **アート作品・イラスト**
   - カラフルで複雑な絵柄
   - ユニークな形状

3. **トレーディングカード**
   - キャラクターイラスト
   - 文字情報との組み合わせ

4. **雑誌の表紙・ポスター**
   - 写真とテキストの組み合わせ
   - カラフルなデザイン

5. **QRコードの周辺デザイン**
   - QRコード単体ではNG
   - 周囲に装飾があればOK

---

## ターゲット画像の作成手順

### ステップ1: 画像の準備

#### 1-1. 既存の画像を使用する場合

- 自社ロゴ、製品パッケージ、チラシなどをスキャン/撮影
- 推奨解像度: 512x512px ~ 1024x1024px
- ファイル形式: JPG または PNG

#### 1-2. 新しく作成する場合

デザインツールで作成：

```
推奨設定:
- サイズ: 1024x1024px
- 解像度: 72dpi (Web用)
- 形式: PNG (透過なし) または JPG
- カラーモード: RGB
```

**デザインのポイント**:
- 中央にメインの絵柄を配置
- 四隅に特徴点が分散するように
- 白い余白を避ける（背景にテクスチャを追加）

### ステップ2: 画像の最適化

#### 2-1. リサイズ

大きすぎる画像は処理が重くなるため、適切なサイズに調整：

```bash
# ImageMagickを使用する場合
convert original.jpg -resize 1024x1024 target.jpg

# オンラインツールでも可
https://www.iloveimg.com/resize-image
```

#### 2-2. コントラスト調整

必要に応じて、画像のコントラストを上げて特徴点を強調：

- Photoshop: イメージ > 色調補正 > コントラスト
- GIMP: 色 > トーンカーブ
- オンライン: https://www.photopea.com/

### ステップ3: プロジェクトに配置

作成した画像を `public/targets/` ディレクトリに配置：

```bash
cp your-target.png /path/to/ar-signboard-app/public/targets/sample-target.png
```

---

## コンパイル方法

MindARで使用するには、画像を `.mind` 形式にコンパイルする必要があります。

### 方法1: オンラインコンパイラー（推奨）

MindAR公式のオンラインツールを使用します。

#### 手順

1. **オンラインコンパイラーにアクセス**

   🔗 https://hiukim.github.io/mind-ar-js-doc/tools/compile

2. **画像をアップロード**

   - 「Select Images」をクリック
   - または、画像をドラッグ&ドロップ
   - `public/targets/sample-target.png` を選択

3. **特徴点の可視化を確認**

   - 「Start」をクリック
   - 画像上に特徴点が表示されます
   - **良い例**: 特徴点が画像全体に均等に分散
   - **悪い例**: 特徴点が一箇所に集中、または少ない

4. **.mindファイルをダウンロード**

   - 「Download」ボタンをクリック
   - `targets.mind` というファイルがダウンロードされます
   - ファイル名を `default-target.mind` に変更
   - `public/targets/` ディレクトリに配置

#### 特徴点の評価

コンパイラーで表示される特徴点の分布を確認：

```
✅ 良い分布:
┌─────────────────┐
│ ●  ●    ●   ●  │
│   ●   ●    ●   │
│ ●    ●  ●   ● │
│   ●   ●    ●   │
│ ●  ●    ●   ●  │
└─────────────────┘

❌ 悪い分布:
┌─────────────────┐
│                 │
│     ●●●●●      │
│     ●●●●●      │
│                 │
│                 │
└─────────────────┘
```

### 方法2: ローカルでコンパイル（上級者向け）

Node.jsスクリプトを使用してローカルでコンパイルすることも可能です。

#### 準備

```bash
# compiler-toolsをインストール
npm install -g @hiukim/mind-ar-js-compiler
```

#### コンパイル実行

```bash
# 基本的な使い方
mind-ar-compiler \
  --input public/targets/sample-target.png \
  --output public/targets/default-target.mind

# 複数のターゲット画像をコンパイル
mind-ar-compiler \
  --input "public/targets/target1.png public/targets/target2.png" \
  --output public/targets/targets.mind
```

**注意**: 執筆時点では、オンラインコンパイラーの方が安定しているため推奨します。

---

## 配置とテスト

### 1. ファイルの配置確認

コンパイルした `.mind` ファイルが正しく配置されているか確認：

```bash
ls -lh public/targets/

# 以下のファイルがあればOK
# default-target.mind
# sample-target.png (オリジナル)
```

### 2. アプリで動作確認

```bash
# 開発サーバーを起動
pnpm dev

# ブラウザで開く
# http://localhost:5173
```

#### テスト手順

1. **「AR体験を開始」ボタンをクリック**
2. **カメラ許可を承認**
3. **印刷したターゲット画像をカメラに向ける**
   - または、別のデバイス（タブレット、PC）に画像を表示
4. **AR看板が表示されることを確認**

### 3. 印刷してテスト（推奨）

実際の使用環境でテストするため、ターゲット画像を印刷します：

#### 印刷設定

```
用紙: A4またはA5
印刷品質: 高品質 (300dpi以上)
カラー: フルカラー
用紙: マット紙推奨（光沢紙は避ける）
サイズ: 10cm x 10cm 以上
```

#### 印刷後の確認

- ✅ 画像がはっきり印刷されている
- ✅ 色が正確に再現されている
- ✅ 折り目やシワがない
- ✅ 光沢や反射が少ない

---

## トラブルシューティング

### 問題1: ターゲット画像が認識されない

#### 原因と対策

| 原因 | 対策 |
|------|------|
| 特徴点が少ない | より複雑な画像を選択、コントラストを上げる |
| 照明が暗い | 十分な明るさを確保 |
| カメラの距離が不適切 | 10cm~50cm の距離を保つ |
| 画像が傾いている | まっすぐ正面から撮影 |
| .mindファイルが古い | 再コンパイルして更新 |

#### 対処手順

1. **オンラインコンパイラーで特徴点を確認**
   - 特徴点が少ない場合は画像を変更

2. **カメラ環境を改善**
   ```
   ✅ 明るい場所で撮影
   ✅ 影が落ちないように
   ✅ 正面から撮影（角度をつけすぎない）
   ```

3. **ターゲット画像を改善**
   - コントラストを上げる
   - サイズを大きくする
   - 背景を追加する

### 問題2: 認識が不安定

#### 原因と対策

| 原因 | 対策 |
|------|------|
| 光沢による反射 | マット紙に印刷、照明を調整 |
| 手ブレ | 画像を固定する（壁に貼る、スタンドに置く） |
| 背景が類似 | 無地の背景でテスト |
| 印刷品質が低い | 高品質で再印刷 |

### 問題3: コンパイルエラー

#### エラーメッセージ別の対処

```
Error: Image too large
→ 画像を1024x1024px以下にリサイズ

Error: Not enough features
→ より複雑なデザインの画像を使用

Error: Invalid file format
→ JPGまたはPNG形式で保存し直す
```

### 問題4: AR表示がずれる

#### 対処方法

1. **キャリブレーション**
   - アプリの `DEFAULT_TRANSFORM` を調整
   - 位置、回転、スケールを微調整

2. **ターゲット画像のアスペクト比**
   - 正方形（1:1）を推奨
   - 長方形の場合はスケールを調整

---

## ベストプラクティス

### 開発時

```bash
# 1. サンプル画像でまず動作確認
pnpm dev

# 2. 複数のターゲット画像を試す
# 3. 実機（スマホ）でテスト
# 4. 異なる照明環境でテスト
```

### 本番環境

```bash
# 1. 高品質なターゲット画像を作成
# 2. オンラインコンパイラーで特徴点を確認
# 3. 印刷してテスト
# 4. ユーザー向けガイドを作成
```

### ユーザー向けガイドの例

```markdown
## AR看板の使い方

1. この画像を印刷してください
   （印刷推奨サイズ: A5、カラー、マット紙）

2. スマホでアプリを開いてください

3. 「AR体験を開始」をタップ

4. 印刷した画像にカメラを向けてください

5. AR看板が表示されます！
```

---

## 参考資料

### 公式ドキュメント

- MindAR公式ドキュメント: https://hiukim.github.io/mind-ar-js-doc/
- オンラインコンパイラー: https://hiukim.github.io/mind-ar-js-doc/tools/compile
- サンプル画像: https://github.com/hiukim/mind-ar-js/tree/master/examples/image-tracking/assets

### 推奨記事

- [How to Choose a Good Target Image for Tracking in AR - Part 1](https://blog.pictarize.com/how-to-choose-a-good-target-image-for-tracking-in-ar-part-1/)
- [How to Choose a Good Target Image for Tracking in AR - Part 2](https://blog.pictarize.com/how-to-choose-a-good-target-image-for-tracking-in-ar-part-2/)

### ツール

- オンライン画像編集: https://www.photopea.com/
- 画像リサイズ: https://www.iloveimg.com/resize-image
- 画像圧縮: https://tinypng.com/

---

## まとめ

### チェックリスト

ターゲット画像を作成する際は、以下を確認してください：

- [ ] 画像サイズは512x512px ~ 1024x1024px
- [ ] 高コントラストで特徴点が豊富
- [ ] 単色や繰り返しパターンを避けている
- [ ] オンラインコンパイラーで特徴点を確認済み
- [ ] `.mind` ファイルを `public/targets/default-target.mind` に配置
- [ ] 開発サーバーで動作確認済み
- [ ] 実機（スマホ）でテスト済み
- [ ] 印刷してテスト済み

すべてにチェックが入れば、AR看板アプリが正常に動作するはずです！

---

## 次のステップ

ターゲット画像の作成が完了したら：

1. [README.md](../README.md) でアプリの全体像を確認
2. [看板デザインの追加](../src/data/signboards.ts) を検討
3. デスクトップ対応を進める（[デスクトップ対応設計.md](20251015_0933_デスクトップ対応設計.md)）

質問がある場合は、プロジェクトの Issue で相談してください！
