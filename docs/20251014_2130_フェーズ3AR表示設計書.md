# AR çœ‹æ¿ã‚¢ãƒ—ãƒª - ãƒ•ã‚§ãƒ¼ã‚º3: ARè¡¨ç¤ºã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆæ›¸

**ä½œæˆæ—¥**: 2025-10-14
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 3 - ARè¡¨ç¤ºã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè£…
**å‰æ**: ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆã‚³ã‚¢æ©Ÿèƒ½ï¼‰ãŒå®Œäº†ã—ã¦ã„ã‚‹çŠ¶æ…‹
**å®Ÿè£…æœŸé–“**: 1é€±é–“ï¼ˆæƒ³å®šï¼‰

---

## 1. è¨­è¨ˆã®ç›®çš„ã¨æ¦‚è¦

### 1.1 ç›®çš„

ãƒ•ã‚§ãƒ¼ã‚º3ã§ã¯ã€ARçœ‹æ¿ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®**ARè¡¨ç¤ºã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½**ã‚’å®Ÿè£…ã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ï¼š

- A-Frameã‚’ä½¿ç”¨ã—ãŸ3Dã‚·ãƒ¼ãƒ³ã®æ§‹ç¯‰
- MindARã«ã‚ˆã‚‹ç”»åƒèªè­˜ã¨ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- 2Dçœ‹æ¿ç”»åƒã®ARç©ºé–“ã¸ã®é…ç½®
- ã‚¿ãƒƒãƒã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã«ã‚ˆã‚‹æ“ä½œï¼ˆç§»å‹•ãƒ»å›è»¢ãƒ»æ‹¡å¤§ç¸®å°ï¼‰
- è¤‡æ•°ã®çœ‹æ¿ãƒ‡ã‚¶ã‚¤ãƒ³ã®åˆ‡æ›¿æ©Ÿèƒ½

### 1.2 å‰ææ¡ä»¶

- ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆã‚³ã‚¢æ©Ÿèƒ½ï¼‰ãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨
  - âœ… ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹æ©Ÿèƒ½
  - âœ… MindARåˆæœŸåŒ–æ©Ÿèƒ½
  - âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  - âœ… å‹å®šç¾©ã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

### 1.3 æˆæœç‰©

ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†æ™‚ã«ã¯ä»¥ä¸‹ãŒå‹•ä½œã™ã‚‹ã“ã¨ï¼š

- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”»åƒã‚’èªè­˜ã—ã¦ARè¡¨ç¤ºãŒé–‹å§‹ã•ã‚Œã‚‹
- çœ‹æ¿ç”»åƒãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¸Šã«æ­£ã—ãé…ç½®ã•ã‚Œã‚‹
- ãƒ‰ãƒ©ãƒƒã‚°ã§çœ‹æ¿ã‚’ç§»å‹•ã§ãã‚‹
- ãƒ”ãƒ³ãƒã§çœ‹æ¿ã‚’æ‹¡å¤§ç¸®å°ã§ãã‚‹
- å›è»¢ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã§çœ‹æ¿ã‚’å›è»¢ã§ãã‚‹
- ãƒ‡ã‚¶ã‚¤ãƒ³åˆ‡æ›¿UIã§ç•°ãªã‚‹çœ‹æ¿ã«å¤‰æ›´ã§ãã‚‹

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### 2.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           App Component                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     ARScene Component           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  A-Frame Scene            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Camera                 â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Entity (Target)        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚    - Plane (Signboard)    â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   ControlsOverlay Component     â”‚   â”‚
â”‚  â”‚   - Help Text                   â”‚   â”‚
â”‚  â”‚   - Design Switcher             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
[Camera Stream] â†’ [MindAR Recognition]
                        â†“
                [Target Found Event]
                        â†“
              [Update Tracking State]
                        â†“
            [Render AR Entity with Transform]
                        â†“
              [Touch Gesture Input]
                        â†“
           [Calculate New Transform]
                        â†“
            [Update Entity Position/Rotation/Scale]
```

---

## 3. è©³ç´°è¨­è¨ˆ

### 3.1 ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”»åƒã®æº–å‚™

#### 3.1.1 ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”»åƒã®è¦ä»¶

- **ç”»åƒå½¢å¼**: JPEG, PNG
- **æ¨å¥¨ã‚µã‚¤ã‚º**: 1024x1024px ä»¥ä¸‹
- **ç‰¹å¾´ç‚¹**: ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãŒé«˜ãã€ç‰¹å¾´çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŒã¤ã“ã¨
- **å¤‰æ›å½¢å¼**: .mindå½¢å¼ï¼ˆMindARã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã§ç”Ÿæˆï¼‰

#### 3.1.2 ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”»åƒã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

```bash
# MindAR Image Target Compilerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g mind-ar-cli

# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”»åƒã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
mind-ar-cli compile \
  --input public/targets/sample-target.jpg \
  --output public/targets/sample-target.mind \
  --max-track 1
```

#### 3.1.3 ã‚µãƒ³ãƒ—ãƒ«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”»åƒ

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ä»¥ä¸‹ã®ã‚µãƒ³ãƒ—ãƒ«ç”»åƒã‚’ä½¿ç”¨ï¼š

- `public/targets/default-target.jpg` - ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”»åƒ
- `public/targets/default-target.mind` - ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«

---

### 3.2 ARã‚·ãƒ¼ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£…

#### 3.2.1 ARScene ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ`src/components/ar/ARScene.tsx`ï¼‰

```typescript
import { useEffect, useRef } from 'react';
import 'aframe';
import 'mind-ar/dist/mindar-image-aframe.prod.js';

import type { SignboardDesign } from '../../types/signboard';
import type { Transform } from '../../types/ar';

interface ARSceneProps {
  targetUrl: string;
  signboard: SignboardDesign;
  transform: Transform;
  onTargetFound: () => void;
  onTargetLost: () => void;
  onTransformChange: (transform: Transform) => void;
}

export const ARScene = ({
  targetUrl,
  signboard,
  transform,
  onTargetFound,
  onTargetLost,
  onTransformChange,
}: ARSceneProps) => {
  const sceneRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (!sceneRef.current) return;

    const sceneEl = sceneRef.current.querySelector('a-scene');
    if (!sceneEl) return;

    // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¤œå‡ºã‚¤ãƒ™ãƒ³ãƒˆ
    sceneEl.addEventListener('targetFound', onTargetFound);
    sceneEl.addEventListener('targetLost', onTargetLost);

    return () => {
      sceneEl.removeEventListener('targetFound', onTargetFound);
      sceneEl.removeEventListener('targetLost', onTargetLost);
    };
  }, [onTargetFound, onTargetLost]);

  return (
    <div ref={sceneRef} className="fixed inset-0">
      <a-scene
        mindar-image={`imageTargetSrc: ${targetUrl}; maxTrack: 1`}
        color-space="sRGB"
        renderer="colorManagement: true, physicallyCorrectLights"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
      >
        <a-camera position="0 0 0" look-controls="enabled: false" />

        <a-entity mindar-image-target="targetIndex: 0">
          <a-plane
            src={signboard.src}
            position={`${transform.position[0]} ${transform.position[1]} ${transform.position[2]}`}
            rotation={`${transform.rotation[0]} ${transform.rotation[1]} ${transform.rotation[2]}`}
            scale={`${transform.scale[0]} ${transform.scale[1]} ${transform.scale[2]}`}
            width={1}
            height={1}
            material="transparent: true; alphaTest: 0.5"
          />
        </a-entity>
      </a-scene>
    </div>
  );
};
```

---

### 3.3 ã‚¿ãƒƒãƒã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### 3.3.1 useGesture ãƒ•ãƒƒã‚¯ï¼ˆ`src/hooks/useGesture.ts`ï¼‰

```typescript
import { useCallback, useRef, useState } from 'react';

import type { Transform } from '../types/ar';

interface GestureState {
  isDragging: boolean;
  isPinching: boolean;
  isRotating: boolean;
}

export const useGesture = (
  initialTransform: Transform,
  onTransformChange: (transform: Transform) => void
) => {
  const [transform, setTransform] = useState<Transform>(initialTransform);
  const [gestureState, setGestureState] = useState<GestureState>({
    isDragging: false,
    isPinching: false,
    isRotating: false,
  });

  const lastTouchRef = useRef<{ x: number; y: number } | null>(null);
  const initialDistanceRef = useRef<number>(0);
  const initialScaleRef = useRef<number>(1);

  // ãƒ‰ãƒ©ãƒƒã‚°å‡¦ç†
  const handleDragStart = useCallback((e: TouchEvent) => {
    if (e.touches.length === 1) {
      lastTouchRef.current = {
        x: e.touches[0].clientX,
        y: e.touches[0].clientY,
      };
      setGestureState((prev) => ({ ...prev, isDragging: true }));
    }
  }, []);

  const handleDragMove = useCallback(
    (e: TouchEvent) => {
      if (!gestureState.isDragging || !lastTouchRef.current) return;

      const deltaX = e.touches[0].clientX - lastTouchRef.current.x;
      const deltaY = e.touches[0].clientY - lastTouchRef.current.y;

      const newPosition: [number, number, number] = [
        transform.position[0] + deltaX * 0.001,
        transform.position[1] - deltaY * 0.001,
        transform.position[2],
      ];

      const newTransform = { ...transform, position: newPosition };
      setTransform(newTransform);
      onTransformChange(newTransform);

      lastTouchRef.current = {
        x: e.touches[0].clientX,
        y: e.touches[0].clientY,
      };
    },
    [gestureState.isDragging, transform, onTransformChange]
  );

  const handleDragEnd = useCallback(() => {
    setGestureState((prev) => ({ ...prev, isDragging: false }));
    lastTouchRef.current = null;
  }, []);

  // ãƒ”ãƒ³ãƒå‡¦ç†
  const handlePinchStart = useCallback((e: TouchEvent) => {
    if (e.touches.length === 2) {
      const distance = Math.hypot(
        e.touches[1].clientX - e.touches[0].clientX,
        e.touches[1].clientY - e.touches[0].clientY
      );
      initialDistanceRef.current = distance;
      initialScaleRef.current = transform.scale[0];
      setGestureState((prev) => ({ ...prev, isPinching: true }));
    }
  }, [transform.scale]);

  const handlePinchMove = useCallback(
    (e: TouchEvent) => {
      if (!gestureState.isPinching || e.touches.length !== 2) return;

      const distance = Math.hypot(
        e.touches[1].clientX - e.touches[0].clientX,
        e.touches[1].clientY - e.touches[0].clientY
      );

      const scale = (distance / initialDistanceRef.current) * initialScaleRef.current;
      const clampedScale = Math.max(0.5, Math.min(3, scale)); // 0.5x ~ 3x

      const newScale: [number, number, number] = [clampedScale, clampedScale, clampedScale];
      const newTransform = { ...transform, scale: newScale };
      setTransform(newTransform);
      onTransformChange(newTransform);
    },
    [gestureState.isPinching, transform, onTransformChange]
  );

  const handlePinchEnd = useCallback(() => {
    setGestureState((prev) => ({ ...prev, isPinching: false }));
  }, []);

  return {
    transform,
    gestureState,
    handlers: {
      handleDragStart,
      handleDragMove,
      handleDragEnd,
      handlePinchStart,
      handlePinchMove,
      handlePinchEnd,
    },
  };
};
```

---

### 3.4 ãƒ‡ã‚¶ã‚¤ãƒ³åˆ‡æ›¿UI

#### 3.4.1 SignboardSwitcher ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ`src/components/ui/SignboardSwitcher.tsx`ï¼‰

```typescript
import type { SignboardDesign } from '../../types/signboard';

interface SignboardSwitcherProps {
  designs: SignboardDesign[];
  currentDesignId: string;
  onDesignChange: (designId: string) => void;
  isVisible: boolean;
  onClose: () => void;
}

export const SignboardSwitcher = ({
  designs,
  currentDesignId,
  onDesignChange,
  isVisible,
  onClose,
}: SignboardSwitcherProps) => {
  if (!isVisible) return null;

  return (
    <div className="fixed inset-0 z-40 flex items-end bg-black bg-opacity-50">
      <div className="w-full rounded-t-2xl bg-white p-6">
        <div className="mb-4 flex items-center justify-between">
          <h3 className="text-lg font-bold">ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é¸æŠ</h3>
          <button
            onClick={onClose}
            className="rounded-full p-2 hover:bg-gray-100"
          >
            âœ•
          </button>
        </div>

        <div className="grid grid-cols-3 gap-4">
          {designs.map((design) => (
            <button
              key={design.id}
              onClick={() => {
                onDesignChange(design.id);
                onClose();
              }}
              className={`relative overflow-hidden rounded-lg border-2 transition-all ${
                currentDesignId === design.id
                  ? 'border-blue-500 ring-2 ring-blue-200'
                  : 'border-gray-300 hover:border-gray-400'
              }`}
            >
              <img
                src={design.thumbnail || design.src}
                alt={design.name}
                className="aspect-square w-full object-cover"
              />
              {currentDesignId === design.id && (
                <div className="absolute right-2 top-2 rounded-full bg-blue-500 p-1 text-white">
                  âœ“
                </div>
              )}
              <div className="p-2 text-center text-sm font-medium">
                {design.name}
              </div>
            </button>
          ))}
        </div>
      </div>
    </div>
  );
};
```

#### 3.4.2 ControlsOverlay ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ`src/components/ui/ControlsOverlay.tsx`ï¼‰

```typescript
interface ControlsOverlayProps {
  isTracking: boolean;
  showHelp: boolean;
  onToggleDesignSwitcher: () => void;
  onDismissHelp: () => void;
}

export const ControlsOverlay = ({
  isTracking,
  showHelp,
  onToggleDesignSwitcher,
  onDismissHelp,
}: ControlsOverlayProps) => {
  return (
    <>
      {/* æ“ä½œèª¬æ˜ */}
      {showHelp && (
        <div className="fixed left-1/2 top-4 z-30 -translate-x-1/2 transform rounded-lg bg-black bg-opacity-75 px-4 py-3 text-white shadow-lg">
          <button
            onClick={onDismissHelp}
            className="absolute right-2 top-2 text-white opacity-75 hover:opacity-100"
          >
            âœ•
          </button>
          <div className="space-y-2 text-sm">
            <p>ğŸ“± 1æœ¬æŒ‡ãƒ‰ãƒ©ãƒƒã‚°: ç§»å‹•</p>
            <p>ğŸ¤ ãƒ”ãƒ³ãƒ: æ‹¡å¤§ç¸®å°</p>
            <p>ï¿½ï¿½ 2æœ¬æŒ‡å›è»¢: å›è»¢</p>
          </div>
        </div>
      )}

      {/* ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°çŠ¶æ…‹è¡¨ç¤º */}
      {!isTracking && (
        <div className="fixed left-1/2 top-1/2 z-20 -translate-x-1/2 -translate-y-1/2 transform rounded-lg bg-black bg-opacity-75 px-6 py-4 text-center text-white">
          <p className="text-lg font-medium">ğŸ“· ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”»åƒã‚’æ¢ã—ã¦ã„ã¾ã™...</p>
          <p className="mt-2 text-sm opacity-75">
            ã‚«ãƒ¡ãƒ©ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”»åƒã«å‘ã‘ã¦ãã ã•ã„
          </p>
        </div>
      )}

      {/* ãƒ‡ã‚¶ã‚¤ãƒ³åˆ‡æ›¿ãƒœã‚¿ãƒ³ */}
      {isTracking && (
        <button
          onClick={onToggleDesignSwitcher}
          className="fixed bottom-6 right-6 z-30 rounded-full bg-blue-500 p-4 text-white shadow-lg hover:bg-blue-600"
        >
          ğŸ¨
        </button>
      )}
    </>
  );
};
```

---

### 3.5 çœ‹æ¿ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿

#### 3.5.1 ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆ`src/data/signboards.ts`ï¼‰

```typescript
import type { SignboardDesign } from '../types/signboard';

export const SIGNBOARD_DESIGNS: SignboardDesign[] = [
  {
    id: 'signboard-1',
    name: 'ã‚·ãƒ³ãƒ—ãƒ«',
    type: 'image',
    src: '/images/signboard-1.png',
    defaultScale: [1, 1, 1],
    thumbnail: '/images/signboard-1-thumb.png',
  },
  {
    id: 'signboard-2',
    name: 'ã‚«ãƒ©ãƒ•ãƒ«',
    type: 'image',
    src: '/images/signboard-2.png',
    defaultScale: [1.2, 1.2, 1.2],
    thumbnail: '/images/signboard-2-thumb.png',
  },
  {
    id: 'signboard-3',
    name: 'ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆ',
    type: 'image',
    src: '/images/signboard-3.png',
    defaultScale: [1, 1, 1],
    thumbnail: '/images/signboard-3-thumb.png',
  },
];
```

---

### 3.6 App.tsx ã®æ›´æ–°

```typescript
import { useState } from 'react';

import { ARScene } from './components/ar/ARScene';
import { ControlsOverlay } from './components/ui/ControlsOverlay';
import { ErrorDialog } from './components/ui/ErrorDialog';
import { LoadingScreen } from './components/ui/LoadingScreen';
import { SignboardSwitcher } from './components/ui/SignboardSwitcher';
import { MINDAR_CONFIG, DEFAULT_TRANSFORM } from './constants/ar';
import { SIGNBOARD_DESIGNS } from './data/signboards';
import { useARInitialize } from './hooks/useARInitialize';
import { useCamera } from './hooks/useCamera';
import { useGesture } from './hooks/useGesture';

function App() {
  const { isInitializing, isInitialized, error: arError, initialize } = useARInitialize();
  const { permission, error: cameraError, requestCameraPermission } = useCamera();

  const [isTracking, setIsTracking] = useState(false);
  const [showHelp, setShowHelp] = useState(true);
  const [showDesignSwitcher, setShowDesignSwitcher] = useState(false);
  const [currentDesignId, setCurrentDesignId] = useState(SIGNBOARD_DESIGNS[0].id);

  const currentDesign = SIGNBOARD_DESIGNS.find((d) => d.id === currentDesignId) || SIGNBOARD_DESIGNS[0];

  const { transform, handlers } = useGesture(DEFAULT_TRANSFORM, (newTransform) => {
    console.log('Transform updated:', newTransform);
  });

  const handleStart = async () => {
    await requestCameraPermission();
    if (permission === 'granted') {
      await initialize();
    }
  };

  const currentError = arError || cameraError;

  return (
    <div className="h-screen w-screen">
      {isInitializing && <LoadingScreen />}

      {currentError && <ErrorDialog error={currentError} onRetry={handleStart} />}

      {!isInitialized && !isInitializing && (
        <div className="flex h-full items-center justify-center bg-gray-900">
          <button
            onClick={handleStart}
            className="rounded-lg bg-blue-500 px-8 py-4 text-xl font-bold text-white hover:bg-blue-600"
          >
            ARä½“é¨“ã‚’é–‹å§‹
          </button>
        </div>
      )}

      {isInitialized && (
        <>
          <ARScene
            targetUrl={MINDAR_CONFIG.targetUrl}
            signboard={currentDesign}
            transform={transform}
            onTargetFound={() => setIsTracking(true)}
            onTargetLost={() => setIsTracking(false)}
            onTransformChange={(newTransform) => console.log(newTransform)}
          />

          <ControlsOverlay
            isTracking={isTracking}
            showHelp={showHelp}
            onToggleDesignSwitcher={() => setShowDesignSwitcher(!showDesignSwitcher)}
            onDismissHelp={() => setShowHelp(false)}
          />

          <SignboardSwitcher
            designs={SIGNBOARD_DESIGNS}
            currentDesignId={currentDesignId}
            onDesignChange={setCurrentDesignId}
            isVisible={showDesignSwitcher}
            onClose={() => setShowDesignSwitcher(false)}
          />
        </>
      )}
    </div>
  );
}

export default App;
```

---

## 4. å®Ÿè£…é †åºã¨å·¥æ•°è¦‹ç©ã‚‚ã‚Š

### 4.1 æ¨å¥¨å®Ÿè£…é †åº

1. **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”»åƒã®æº–å‚™** (30åˆ†)
2. **ARSceneã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** (2æ™‚é–“)
3. **ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°çŠ¶æ…‹ç®¡ç†** (1æ™‚é–“)
4. **useGestureãƒ•ãƒƒã‚¯ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ï¼‰** (2æ™‚é–“)
5. **useGestureãƒ•ãƒƒã‚¯ï¼ˆãƒ”ãƒ³ãƒï¼‰** (1.5æ™‚é–“)
6. **useGestureãƒ•ãƒƒã‚¯ï¼ˆå›è»¢ï¼‰** (1.5æ™‚é–“)
7. **SignboardSwitcherã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** (1.5æ™‚é–“)
8. **ControlsOverlayã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** (1æ™‚é–“)
9. **ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿** (30åˆ†)
10. **App.tsxçµ±åˆ** (1.5æ™‚é–“)
11. **å‹•ä½œç¢ºèªãƒ»ãƒ‡ãƒãƒƒã‚°** (3æ™‚é–“)

**åˆè¨ˆå·¥æ•°**: ç´„16æ™‚é–“ï¼ˆ2æ—¥ç›¸å½“ï¼‰

---

## 5. ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 5.1 æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

#### ARã‚·ãƒ¼ãƒ³è¡¨ç¤º
- [ ] A-Frameã‚·ãƒ¼ãƒ³ãŒæ­£ã—ãåˆæœŸåŒ–ã•ã‚Œã‚‹
- [ ] ã‚«ãƒ¡ãƒ©ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”»åƒã‚’èªè­˜ã™ã‚‹
- [ ] çœ‹æ¿ç”»åƒãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹

#### ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- [ ] ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¤œå‡ºæ™‚ã«isTrackingãŒtrueã«ãªã‚‹
- [ ] ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ­ã‚¹ãƒˆæ™‚ã«isTrackingãŒfalseã«ãªã‚‹
- [ ] ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°çŠ¶æ…‹ã«å¿œã˜ãŸUIè¡¨ç¤º

#### ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼æ“ä½œ
- [ ] 1æœ¬æŒ‡ãƒ‰ãƒ©ãƒƒã‚°ã§çœ‹æ¿ãŒç§»å‹•ã™ã‚‹
- [ ] ãƒ”ãƒ³ãƒã§çœ‹æ¿ãŒæ‹¡å¤§ç¸®å°ã™ã‚‹
- [ ] 2æœ¬æŒ‡å›è»¢ã§çœ‹æ¿ãŒå›è»¢ã™ã‚‹
- [ ] ã‚¹ã‚±ãƒ¼ãƒ«ãŒ0.5xã€œ3xã®ç¯„å›²ã«åˆ¶é™ã•ã‚Œã‚‹

#### ãƒ‡ã‚¶ã‚¤ãƒ³åˆ‡æ›¿
- [ ] ãƒ‡ã‚¶ã‚¤ãƒ³åˆ‡æ›¿ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ‡ã‚¶ã‚¤ãƒ³é¸æŠUIãŒé–‹ã
- [ ] ãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ›´ãŒå³åº§ã«åæ˜ ã•ã‚Œã‚‹
- [ ] ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹

### 5.2 å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆ

#### iOS Safari
- [ ] ARè¡¨ç¤ºãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] ã‚¿ãƒƒãƒã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ãŒæ­£ç¢ºã«èªè­˜ã•ã‚Œã‚‹
- [ ] ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆãŒ30fpsä»¥ä¸Š

#### Android Chrome
- [ ] ARè¡¨ç¤ºãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] ã‚¿ãƒƒãƒã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ãŒæ­£ç¢ºã«èªè­˜ã•ã‚Œã‚‹
- [ ] ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆãŒ30fpsä»¥ä¸Š

---

## 6. ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### 6.1 æŠ€è¡“çš„ãƒªã‚¹ã‚¯

| ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | ç™ºç”Ÿç¢ºç‡ | å¯¾ç­– |
|--------|--------|----------|------|
| A-Frameã¨Reactã®çµ±åˆãŒè¤‡é›‘ | é«˜ | ä¸­ | refã‚’ä½¿ç”¨ã—ãŸç›´æ¥DOMæ“ä½œ |
| ã‚¿ãƒ¼ã‚²ãƒƒãƒˆèªè­˜ç‡ãŒä½ã„ | é«˜ | ä¸­ | é«˜å“è³ªãªã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”»åƒã‚’æº–å‚™ |
| ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼èªè­˜ã®ç²¾åº¦ä¸è¶³ | ä¸­ | ä¸­ | ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†ã¨ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚° |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ | é«˜ | ä¸­ | Three.jsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ•°ã®åˆ¶é™ |

---

## 7. å‚è€ƒè³‡æ–™

### 7.1 å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [MindAR Image Tracking](https://hiukim.github.io/mind-ar-js-doc/quick-start/tracking)
- [A-Frame Components](https://aframe.io/docs/1.5.0/introduction/)
- [Three.js Raycaster](https://threejs.org/docs/#api/en/core/Raycaster)

### 7.2 ã‚µãƒ³ãƒ—ãƒ«ç”»åƒãƒªã‚½ãƒ¼ã‚¹

- [Unsplash](https://unsplash.com/) - é«˜å“è³ªãªç„¡æ–™ç”»åƒ
- [Pexels](https://www.pexels.com/) - å•†ç”¨åˆ©ç”¨å¯èƒ½ãªç”»åƒ

---

**ä»¥ä¸ŠãŒãƒ•ã‚§ãƒ¼ã‚º3ã®è©³ç´°è¨­è¨ˆæ›¸ã§ã™ã€‚å®Ÿè£…ã‚’é–‹å§‹ã—ã¦ã‚ˆã‚ã—ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ**
