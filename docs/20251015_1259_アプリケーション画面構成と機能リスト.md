# AR看板アプリケーション - 画面構成と実装機能リスト

作成日: 2025年10月15日

## 目次

1. [画面構成](#画面構成)
2. [実装済み機能リスト](#実装済み機能リスト)
3. [コンポーネント構成](#コンポーネント構成)
4. [カスタムフック](#カスタムフック)

---

## 画面構成

### 1. スタート画面（初期画面）

**表示条件**: AR未初期化 かつ 初期化処理中でない

**UI要素**:

- 「AR体験を開始」ボタン
- 対応ブラウザの説明テキスト
- 「ターゲット画像を表示」ボタン
- ターゲット画像表示の説明テキスト

**主な機能**:

- カメラ権限のリクエスト
- AR初期化の開始
- ターゲット画像のモーダル表示

**実装箇所**: `src/App.tsx` (107-128行目)

---

### 2. ローディング画面

**表示条件**: AR初期化処理中

**UI要素**:

- ローディングアニメーション
- 「初期化中...」のテキスト

**主な機能**:

- AR環境の初期化待機表示
- ユーザーへのフィードバック

**実装箇所**: `src/components/ui/LoadingScreen.tsx`

---

### 3. エラーダイアログ

**表示条件**: ARエラーまたはカメラエラーが発生

**UI要素**:

- エラーメッセージ
- 「再試行」ボタン

**主な機能**:

- エラー内容の表示
- リトライ機能

**実装箇所**: `src/components/ui/ErrorDialog.tsx`

---

### 4. ARメイン画面

**表示条件**: AR初期化完了

**UI要素**:

- ARカメラビュー（全画面）
- ARシーン（3Dモデル表示エリア）
- コントロールオーバーレイ
- ターゲット画像表示ボタン（右上）
- キャプチャボタン（ターゲット認識時のみ）
- 看板切り替えスイッチャー（表示/非表示切替可能）

**主な機能**:

- リアルタイムカメラ映像表示
- ターゲット画像の認識
- 3Dモデル（案内看板）のAR表示
- ジェスチャー操作（移動・拡大縮小・回転）
- 画面キャプチャ
- 看板デザインの切り替え

**実装箇所**:

- ARシーン: `src/components/ar/ARScene.tsx`
- メイン画面: `src/App.tsx` (130-191行目)

---

### 5. コントロールオーバーレイ

**表示条件**: AR初期化完了

**UI要素**:

- ターゲット認識状態の表示
- ヘルプメッセージ（初回のみ表示、消去可能）
- 看板切り替えボタン

**主な機能**:

- AR体験の操作ガイド表示
- 看板切り替えスイッチャーの開閉

**実装箇所**: `src/components/ui/ControlsOverlay.tsx`

---

### 6. キャプチャプレビュー画面

**表示条件**: キャプチャ成功後

**UI要素**:

- キャプチャした画像のプレビュー
- 「保存」ボタン
- 「撮り直し」ボタン
- 「共有」ボタン（対応ブラウザのみ）
- 「閉じる」ボタン

**主な機能**:

- キャプチャ画像の確認
- 画像の保存（ダウンロード）
- 画像の共有（Web Share API対応時）
- 撮り直し

**実装箇所**: `src/components/ui/CapturePreview.tsx`

---

### 7. キャプチャエラー表示

**表示条件**: キャプチャ処理でエラーが発生

**UI要素**:

- エラーメッセージ
- 「再試行」ボタン
- 「閉じる」ボタン

**主な機能**:

- キャプチャエラーの表示
- リトライ機能

**実装箇所**: `src/components/ui/CaptureError.tsx`

---

### 8. 看板切り替えスイッチャー

**表示条件**: AR初期化完了 かつ スイッチャー表示フラグがtrue

**UI要素**:

- 看板デザインのサムネイル一覧
- 各看板の名前
- 「閉じる」ボタン

**主な機能**:

- 看板デザインの切り替え
- 現在選択中のデザインのハイライト表示

**実装箇所**: `src/components/ui/SignboardSwitcher.tsx`

---

### 9. ターゲット画像表示モーダル

**表示条件**: 「ターゲット画像を表示」ボタンをクリック

**UI要素**:

- ターゲット画像の拡大表示
- 「閉じる」ボタン

**主な機能**:

- ターゲット画像の確認
- QRコードスキャン用の表示

**実装箇所**: `src/components/ui/TargetImageDisplay.tsx`

---

## 実装済み機能リスト

### ✅ コア機能

#### 1. AR表示機能

- [x] MindAR による画像認識
- [x] A-Frame による3Dレンダリング
- [x] ターゲット画像の検出・追跡
- [x] 3Dモデル（案内看板）の表示
- [x] リアルタイムカメラ映像との合成

#### 2. カメラ機能

- [x] カメラ権限のリクエスト
- [x] カメラストリームの取得
- [x] カメラエラーハンドリング
- [x] カメラ権限状態の管理

#### 3. AR初期化機能

- [x] MindAR の初期化
- [x] A-Frame の初期化
- [x] 初期化状態の管理
- [x] 初期化エラーハンドリング

#### 4. ターゲット認識機能

- [x] ターゲット検出イベントの処理
- [x] ターゲット喪失イベントの処理
- [x] 認識状態の表示

---

### ✅ 操作機能

#### 5. ジェスチャー操作

- [x] タッチジェスチャーの検出
- [x] 3Dモデルの移動（パン）
- [x] 3Dモデルの拡大縮小（ピンチ）
- [x] 3Dモデルの回転（2本指回転）
- [x] トランスフォームの状態管理

#### 6. 看板切り替え機能

- [x] 複数の看板デザインの管理
- [x] 看板デザインの切り替え
- [x] 看板スイッチャーUIの表示/非表示
- [x] 現在選択中のデザインの保持

**注**: 現在は3Dモデルが固定されているため、看板デザイン切り替えは2D画像時代の名残です。

---

### ✅ キャプチャ機能

#### 7. 画面キャプチャ

- [x] ARシーン全体のキャプチャ
- [x] html2canvas によるスクリーンショット
- [x] キャプチャ処理中の状態表示
- [x] キャプチャエラーハンドリング

#### 8. 画像保存機能

- [x] キャプチャ画像のダウンロード
- [x] ファイル名の自動生成（タイムスタンプ付き）
- [x] 保存処理中の状態表示
- [x] 保存完了のフィードバック

#### 9. 画像共有機能

- [x] Web Share API による共有（対応ブラウザのみ）
- [x] 共有処理中の状態表示
- [x] 共有エラーハンドリング
- [x] 非対応ブラウザでの共有ボタン非表示

---

### ✅ UI/UX機能

#### 10. ローディング表示

- [x] AR初期化中のローディング画面
- [x] アニメーション効果
- [x] 進行状況のフィードバック

#### 11. エラー表示

- [x] ARエラーの表示
- [x] カメラエラーの表示
- [x] キャプチャエラーの表示
- [x] リトライ機能

#### 12. ヘルプ・ガイド

- [x] 初回表示時のヘルプメッセージ
- [x] ヘルプの消去機能
- [x] 操作方法の説明

#### 13. ターゲット画像表示

- [x] ターゲット画像のモーダル表示
- [x] AR起動前の画像表示
- [x] AR起動中の画像表示
- [x] モーダルの開閉

---

### ✅ 3Dモデル機能

#### 14. 3Dモデル管理

- [x] glTF形式の3Dモデル対応
- [x] 案内看板モデル（guide-sign.gltf）
- [x] サンプルモデル（cube, pyramid）
- [x] モデルの読み込み・表示

---

## コンポーネント構成

### ARコンポーネント

#### `ARScene.tsx`

**役割**: A-Frame と MindAR を使用したAR表示

**Props**:

- `targetUrl`: ターゲット画像のURL
- `transform`: 3Dモデルの位置・回転・スケール
- `onTargetFound`: ターゲット検出時のコールバック
- `onTargetLost`: ターゲット喪失時のコールバック

**主な機能**:

- MindAR の初期化
- ターゲット検出イベントの処理
- 3Dモデルの表示

---

### UIコンポーネント

#### `LoadingScreen.tsx`

**役割**: AR初期化中のローディング表示

**Props**: なし

**主な機能**:

- ローディングアニメーション
- 初期化中メッセージの表示

---

#### `ErrorDialog.tsx`

**役割**: エラーメッセージの表示

**Props**:

- `error`: エラーオブジェクト
- `onRetry`: 再試行時のコールバック

**主な機能**:

- エラーメッセージの表示
- リトライボタン

---

#### `ControlsOverlay.tsx`

**役割**: AR画面上のコントロール表示

**Props**:

- `isTracking`: ターゲット認識状態
- `showHelp`: ヘルプ表示フラグ
- `onToggleDesignSwitcher`: 看板切り替え表示トグル
- `onDismissHelp`: ヘルプ消去時のコールバック

**主な機能**:

- ターゲット認識状態の表示
- ヘルプメッセージの表示
- 看板切り替えボタン

---

#### `CaptureButton.tsx`

**役割**: キャプチャボタンの表示

**Props**:

- `onCapture`: キャプチャ実行時のコールバック
- `isCapturing`: キャプチャ処理中フラグ

**主な機能**:

- キャプチャボタンの表示
- キャプチャ処理中の表示切り替え

---

#### `CapturePreview.tsx`

**役割**: キャプチャ画像のプレビューと操作

**Props**:

- `imageUrl`: キャプチャ画像のURL
- `onSave`: 保存時のコールバック
- `onRetake`: 撮り直し時のコールバック
- `onShare`: 共有時のコールバック（オプション）
- `onClose`: 閉じる時のコールバック
- `isSaving`: 保存処理中フラグ
- `isSharing`: 共有処理中フラグ

**主な機能**:

- 画像プレビュー表示
- 保存・撮り直し・共有ボタン

---

#### `CaptureError.tsx`

**役割**: キャプチャエラーの表示

**Props**:

- `error`: エラーオブジェクト
- `onRetry`: 再試行時のコールバック
- `onDismiss`: 閉じる時のコールバック

**主な機能**:

- キャプチャエラーメッセージの表示
- リトライボタン

---

#### `SignboardSwitcher.tsx`

**役割**: 看板デザインの切り替え

**Props**:

- `designs`: 看板デザインの配列
- `currentDesignId`: 現在選択中のデザインID
- `onDesignChange`: デザイン変更時のコールバック
- `isVisible`: 表示/非表示フラグ
- `onClose`: 閉じる時のコールバック

**主な機能**:

- 看板デザインの一覧表示
- デザインの選択

**注**: 現在は3Dモデル固定のため、実質的には未使用

---

#### `TargetImageDisplay.tsx`

**役割**: ターゲット画像のモーダル表示

**Props**:

- `imageUrl`: ターゲット画像のURL
- `onClose`: 閉じる時のコールバック

**主な機能**:

- ターゲット画像の拡大表示
- モーダルの開閉

---

## カスタムフック

### `useARInitialize.ts`

**役割**: AR環境の初期化管理

**戻り値**:

- `isInitializing`: 初期化処理中フラグ
- `isInitialized`: 初期化完了フラグ
- `error`: エラーオブジェクト
- `initialize`: 初期化実行関数

**主な機能**:

- MindAR と A-Frame の初期化
- 初期化状態の管理
- エラーハンドリング

---

### `useCamera.ts`

**役割**: カメラ権限とストリームの管理

**戻り値**:

- `permission`: 権限状態（'prompt' | 'granted' | 'denied'）
- `error`: エラーオブジェクト
- `requestCameraPermission`: 権限リクエスト関数

**主な機能**:

- カメラ権限のリクエスト
- 権限状態の管理
- カメラエラーハンドリング

---

### `useCapture.ts`

**役割**: 画面キャプチャ機能の管理

**戻り値**:

- `isCapturing`: キャプチャ処理中フラグ
- `isSaving`: 保存処理中フラグ
- `isSharing`: 共有処理中フラグ
- `captureResult`: キャプチャ結果（画像データ）
- `error`: エラーオブジェクト
- `capture`: キャプチャ実行関数
- `save`: 保存実行関数
- `share`: 共有実行関数
- `reset`: リセット関数
- `clearError`: エラークリア関数

**主な機能**:

- html2canvas による画面キャプチャ
- 画像の保存（ダウンロード）
- 画像の共有（Web Share API）
- エラーハンドリング

---

### `useGesture.ts`

**役割**: タッチジェスチャーの検出と処理

**戻り値**:

- `transform`: 現在のトランスフォーム（位置・回転・スケール）

**主な機能**:

- タッチイベントの検出
- パン（移動）ジェスチャー
- ピンチ（拡大縮小）ジェスチャー
- 回転ジェスチャー
- トランスフォームの更新

---

## 技術スタック

### フロントエンド

- **React** 18.3.1: UIライブラリ
- **TypeScript** 5.7.3: 型安全な開発
- **Vite** 7.1.9: ビルドツール
- **Tailwind CSS** 4.1.7: スタイリング

### AR関連

- **MindAR** 1.2.5: 画像認識AR
- **A-Frame** 1.6.0: WebXRフレームワーク
- **Three.js** 0.150.0: 3Dレンダリング

### その他

- **html2canvas** 1.4.1: スクリーンショット
- **ESLint**: コード品質チェック
- **Prettier**: コードフォーマット

---

## ディレクトリ構成

```
src/
├── components/
│   ├── ar/              # AR関連コンポーネント
│   │   └── ARScene.tsx
│   ├── ui/              # UIコンポーネント
│   │   ├── CaptureButton.tsx
│   │   ├── CaptureError.tsx
│   │   ├── CapturePreview.tsx
│   │   ├── ControlsOverlay.tsx
│   │   ├── ErrorDialog.tsx
│   │   ├── LoadingScreen.tsx
│   │   ├── SignboardSwitcher.tsx
│   │   └── TargetImageDisplay.tsx
│   └── layout/          # レイアウトコンポーネント
│       ├── AppLayout.tsx
│       └── index.ts
├── hooks/               # カスタムフック
│   ├── useARInitialize.ts
│   ├── useCamera.ts
│   ├── useCapture.ts
│   └── useGesture.ts
├── types/               # 型定義
│   ├── ar.ts
│   ├── camera.ts
│   ├── signboard.ts
│   └── aframe.d.ts
├── constants/           # 定数
│   └── ar.ts
├── data/                # データ
│   └── signboards.ts
├── utils/               # ユーティリティ
├── ar/                  # AR関連ロジック
├── context/             # React Context
├── assets/              # 静的アセット
├── App.tsx              # メインコンポーネント
├── main.tsx             # エントリーポイント
└── index.css            # グローバルスタイル
```

---

## 今後の拡張候補

### 未実装機能（検討中）

1. **3Dモデル切り替え機能**
   - 複数の3Dモデルをリアルタイムで切り替え
   - モデル切り替えUI

2. **テクスチャ編集機能**
   - 看板にカスタムテキスト・画像を追加
   - リアルタイムプレビュー

3. **アニメーション機能**
   - 3Dモデルの回転アニメーション
   - エフェクト追加

4. **マルチターゲット対応**
   - 複数のターゲット画像の認識
   - 複数のARオブジェクト表示

5. **パフォーマンス改善**
   - モデルの遅延読み込み
   - テクスチャ圧縮
   - メモリ最適化

6. **アクセシビリティ向上**
   - キーボード操作対応
   - スクリーンリーダー対応
   - カラーコントラスト改善

---

## まとめ

このAR看板アプリケーションは、MindARとA-Frameを活用した画像認識ベースのARアプリケーションです。
カメラ機能、AR表示、ジェスチャー操作、キャプチャ機能など、基本的な機能は実装済みです。

現在は3Dモデル（案内看板）を固定で表示していますが、今後は3Dモデルの切り替えやテクスチャ編集などの
拡張機能を追加することで、より柔軟で実用的なアプリケーションに発展させることができます。
