# 要件定義書 — AR 看板フォト体験（MindAR 利用版）

## 1. 目的・背景

**目的**

- 卒業式・記念行事等で、ユーザーがスマホで仮想看板を設置して撮影できる体験を提供し、SNS 拡散や来場者体験価値を高める。
- 従来の物理的看板だけでなく、仮想看板を組み合わせることで、撮影の多様性・インタラクティブ性を強化する。

**背景**

- 物理看板は行列の元となる。
- アプリ不要、ブラウザでアクセスできる形式が望ましい。

## 2. 対象範囲（スコープ）

### 含む機能

- AR 看板の配置・表示（2D 画像または 3D モデル）
- ユーザー操作による移動・拡大縮小・回転
- AR + カメラ映像の合成スクリーンキャプチャ
- キャプチャプレビュー・再撮影・保存操作
- UI／UX：読み込み画面、スキャン誘導、操作説明、エラー表示
- 複数看板デザインの切替え
- iOS／Android のモバイルブラウザ対応
- エラー時の対応（カメラアクセス拒否、認識失敗等）

### 対象外（初版フェーズ）

- 複数ユーザー同時 AR 体験（コラボ体験）
- 高度なライティングや遮蔽（オクルージョン）処理
- SNS 投稿 API 連携（ユーザー任意手動シェア対応とする）
- 手追跡・体追跡等の高度 AR 機能

## 3. 用語定義 / 略語

| 用語                    | 定義                                                              |
| ----------------------- | ----------------------------------------------------------------- |
| ターゲット画像          | MindAR が認識対象として利用する画像資材（追跡基準画像）           |
| トラッキング            | ターゲット画像をカメラ映像上で継続的に追跡する処理                |
| エンティティ / アンカー | AR 表示オブジェクトが紐づけられる仮想上の基点                     |
| キャプチャ              | AR 表示 + カメラ映像を合成して画像ファイルを生成する機能          |
| UI フロー               | 読み込み → スキャン → 配置 → 撮影 → 保存 などの画面遷移／操作流れ |

## 4. 機能要件

### 4.1 AR 表示・配置機能

- ターゲット画像認識成功時に AR 看板を表示
- ユーザーがドラッグで平面上移動、ピンチ操作で拡大縮小、2 本指回転で回転を操作できる
- デザイン切替ボタンにより看板のデザイン（画像／モデル）を切り替え可能
- 初期表示ポーズ（位置・角度・スケール）を設定可能

### 4.2 キャプチャ・保存機能

- AR 表示 + カメラ映像を合成し、画像キャプチャを生成
- キャプチャ後にプレビュー画面を出し、保存 or 再撮影の選択肢を提示
- 端末のフォトギャラリーへ保存可能
- 保存成功／失敗の通知表示

### 4.3 UI / 操作誘導

- 読み込み画面にローディングインジケータ
- スキャン誘導表示（例：枠・波紋・アニメーションでカメラ移動を促す）
- 操作説明表示（移動・拡大・回転などの操作方法）
- エラー表示：カメラ許可拒否、トラッキング失敗、モデル読み込み失敗等
- フォールバック案内：対応していないブラウザ時のメッセージ表示

### 4.4 イベント / 状態管理

- 認識開始／認識成功／認識失敗のイベント
- AR 初期化完了イベント
- 配置確定完了イベント
- キャプチャ完了イベント

## 5. 非機能要件 / 技術要件

### 5.1 対応環境

- OS：iOS / Android
- ブラウザ：Safari（iOS）、Chrome（Android） 等のモバイルブラウザ
- 通信：HTTPS 必須
- 最低端末要件（カメラ性能、GPU 性能、メモリ容量を注意）

### 5.2 性能要件

- AR 初期化（認識待ち画面表示） ≤ 3〜5 秒以内
- フレームレート：理想 60fps、最低 30fps は確保
- モデル／テクスチャの最大容量制限（例：1〜3 MB、ポリゴン数制限）
- メモリ使用量抑制

### 5.3 信頼性 / 障害対応

- 認識失敗時には再試行ループを設ける
- カメラアクセス拒否時は誘導 UI 表示
- リソース読み込みエラー時フォールバック処理
- ブラウザ固有の不具合対応（例：iOS 側の仕様差、glTF 表示制限 等）

## 6. 画面 / UI 要件

- モックアップ／ワイヤーフレーム化（スキャン画面、配置画面、撮影画面、保存確認画面）
- 各画面のレイアウト仕様（ボタン配置、余白、フォント、色調）
- 画面遷移図・ユーザー操作フロー図
- 縦画面／横画面対応を考慮

## 7. 操作フロー / ユーザーシナリオ

1. ユーザーが QR コードを読み取り → AR ページへ遷移
2. カメラ使用許可をリクエスト → ユーザーが許可
3. MindAR 初期化 → スキャン誘導表示
4. ターゲット認識成功 → AR 看板を表示
5. ユーザー操作で位置／角度／スケールを調整
6. 「撮影」ボタン押下 → キャプチャ実行
7. プレビュー画面に遷移 → 保存または再撮影
8. 保存成功後体験終了 or 再挑戦

## 8. 制約条件 / 前提条件

- MindAR 標準機能（画像トラッキング）を使う仕様
- 平面認識（SLAM／ワールドトラッキング）は標準対象外とする
- ターゲット画像はトラッキング性能の高い画像を選定（特徴点多め、コントラスト高め）
- モデル・テクスチャは軽量化必須
- ブラウザ対応差異を前提とし、フォールバック手段を用意

## 9. 外部インタフェース / API 要件

- 看板デザイン画像／3D モデル取得（CDN／オブジェクトストレージ）
- 任意：画像保存・アクセスログ取得 API
- 任意：イベントログ／分析 API

## 10. セキュリティ / 権限要件

- 全体は HTTPS 配信
- カメラアクセスはユーザー明示許可制
- ユーザー提供データ取り扱う場合は入力バリデーション
- クロスサイト攻撃対策（XSS, CSRF など）
- CORS 設定適正化

## 11. パフォーマンス要件

- 再読み込み時キャッシュ有効活用
- リソースプリロード戦略
- レンダリング最適化（バッチ処理、LOD、テクスチャ圧縮など）
- メモリリーク防止

## 12. テスト要件 / 品質保証

- 対応端末・ブラウザ一覧（iOS / Android 各種）での動作確認
- 認識率テスト（異なる光源・角度・距離条件）
- キャプチャ機能テスト
- UI／UX 操作誤操作耐性テスト
- 回帰テストおよびクロスブラウザテスト

## 13. 運用・保守要件

- 看板デザイン差し替え方式（デザイン管理 UI or JSON 指定）
- MindAR ライブラリの将来バージョン対応
- 不具合修正プロセス
- アクセスログ・エラー監視
- 更新デプロイ体制

## 14. スケジュール / マイルストーン

- 要件定義完了
- デザイン確定
- プロトタイプ実装
- UI 実装
- 動作検証 / デバイステスト
- パフォーマンス最適化
- 総合テスト
- リリース

## 15. リスクと対応策

| リスク                       | 対応策                                                   |
| ---------------------------- | -------------------------------------------------------- |
| ターゲット画像が認識しづらい | 認識可能な画像ガイドライン作成、差し替えしやすく設計する |
| 照明や反射条件で認識失敗     | 環境誘導 UI、明るさ制限案内                              |
| 低性能端末で処理落ち         | 軽量モードへの切り替え、モデル簡易版提供                 |
| iOS Safari の挙動制約        | フォールバック案内、対応ブラウザの推奨表示               |
| ブラウザの互換性問題         | 対応ブラウザリスト作成・事前検証                         |

## 16. 変更管理 / バージョン管理

- 要件変更手順・承認プロセス
- 文書リビジョン管理（例：バージョン番号付与）
- Git 等でのコードバージョン管理
