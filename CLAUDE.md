# Claude Code 設定

## 設計作業ルール

設計作業を依頼された場合は、以下のルールに従ってファイルを作成すること：

- ファイル名: `YYYYMMDD_HHMM_{日本語の作業内容}.md`
- 保存場所: `docs/` 以下
- フォーマット: Markdown

例: `docs/20251014_1756_AR看板要件定義.md`

## AR 看板アプリケーションの実装ルール

### 基本方針

- React + TypeScript + Vite による SPA (Single Page Application) として実装
- MindAR を使用した画像認識ベースの AR 機能を提供
- A-Frame と連携して AR オブジェクトの配置・操作を実現
- CSS は Tailwind CSS を使用してスタイリング
- モバイルファーストのレスポンシブデザインを採用
- ESLint と Prettier を導入し、コード品質と一貫性を確保
- モバイルブラウザ (iOS Safari / Android Chrome) での動作を最優先
- パフォーマンスを重視し、軽量で高速なユーザー体験を実現

### フロントエンド実装の原則

- [src/](src/) 配下にコンポーネント、フック、型定義、ユーティリティを配置する
- 再利用可能な UI コンポーネントは [src/components/](src/components/) に配置する
- カスタムフックは [src/hooks/](src/hooks/) に配置する
- 型定義は [src/types/](src/types/) に配置する
- ユーティリティ関数は [src/utils/](src/utils/) に配置する
- AR 関連のロジックは [src/ar/](src/ar/) に配置する
- 状態管理はできるだけシンプルに保ち、React の hooks (useState, useContext 等) を活用する
- MindAR と A-Frame の初期化・制御は適切にカプセル化し、メモリリークを防ぐ

### AR 機能実装の原則

- MindAR の画像認識機能を活用し、ターゲット画像を基準に AR オブジェクトを配置
- AR オブジェクトの操作（移動・拡大縮小・回転）はタッチイベントで直感的に実装
- カメラ映像と AR 表示の合成キャプチャ機能を提供
- 認識失敗時や環境エラー時の適切なフォールバック処理を実装
- ターゲット画像は特徴点が多く、コントラストが高い画像を使用
- 3D モデルやテクスチャは軽量化し、パフォーマンスを確保（推奨: 1〜3 MB 以下）

### パフォーマンス最適化

- フレームレートは 60fps を目標とし、最低 30fps を確保
- リソースの遅延読み込みやプリロードを活用
- 不要なレンダリングを避けるため、React.memo や useMemo を適切に使用
- メモリリークを防ぐため、useEffect のクリーンアップ関数を確実に実装
- 低性能端末向けに軽量モードの提供を検討

## コード構成

以下のディレクトリ構成に従ってコードを配置する：

```
ar-signboard-app/
├── docs/                    # ドキュメント、要件定義、設計書
├── public/
│   ├── targets/             # ターゲット画像（.mind形式）
│   ├── models/              # 3Dモデル（glTF形式）
│   └── images/              # 2D看板画像
├── src/
│   ├── components/
│   │   ├── ar/              # AR関連コンポーネント（シーン、カメラ、エンティティ、操作）
│   │   ├── ui/              # UI コンポーネント（ローディング、エラー、プレビュー等）
│   │   └── layout/          # レイアウトコンポーネント
│   ├── hooks/               # カスタムフック（AR初期化、カメラ、認識、操作、キャプチャ）
│   ├── ar/                  # AR 関連ロジック（MindAR/A-Frame制御、キャプチャサービス）
│   ├── types/               # TypeScript 型定義（AR、カメラ、看板、UI）
│   ├── utils/               # ユーティリティ関数（ブラウザ判定、パフォーマンス監視、バリデーション）
│   ├── context/             # React Context（AR状態管理）
│   ├── constants/           # 定数定義（AR設定、アプリケーション設定）
│   ├── App.tsx              # メインアプリケーション
│   ├── main.tsx             # エントリーポイント
│   └── index.css            # グローバルスタイル（Tailwind CSS v4）
├── eslint.config.js         # ESLint 設定
├── tsconfig.json            # TypeScript 設定
├── vite.config.ts           # Vite 設定
└── package.json             # 依存関係管理
```

## GitHub 操作ルール

- ブランチ戦略: `main` ブランチを本番環境、`develop` ブランチを開発環境とする
- フィーチャー開発時は `feature/xxx` ブランチを作成
- PR を出す際は、現在の作業をフィーチャーブランチにコミットしてから PR を作成
- `main` や `develop` への直接 push は禁止
- PR 作成時は `gh pr create` コマンドに `--base` オプションを付けず、デフォルトのベースブランチを使用
- コミット前に自動的に ESLint、Prettier、型チェックを実行するよう設定

## Tailwind CSS 使用ルール（v4）

### スタイリング原則

- インラインでユーティリティクラスを使用する
- カスタム CSS は `@theme` ディレクティブを使って `index.css` で定義する
- `@apply` ディレクティブの使用は避け、コンポーネント化で対応する
- レスポンシブデザインは Tailwind のブレークポイント（`sm:`, `md:`, `lg:`, `xl:`）を活用
- ダークモード対応が必要な場合は `dark:` プレフィックスを使用
- アニメーションやトランジションは Tailwind の組み込みユーティリティを優先

### クラス命名規則

- 論理的な順序でクラスを記述：レイアウト → サイズ → スペーシング → タイポグラフィ → 色 → その他
- 可読性のため、適宜改行やグループ化を行う
- 条件付きクラスは `clsx` や `classnames` ライブラリを使用して管理

### カスタマイズ（v4 の変更点）

- **Tailwind CSS v4 では `tailwind.config.js` は不要**
- プロジェクト固有の色やスペーシングは `src/index.css` の `@theme` ディレクティブで定義
- カスタムカラー例: `--color-ar-primary: #00d9ff;` → `bg-ar-primary` で使用可能
- カスタムスペーシング例: `--spacing-safe-top: env(safe-area-inset-top);` → `pt-safe-top` で使用可能
- カスタムアニメーション例: `--animate-fade-in: fade-in 0.3s ease-out;` → `animate-fade-in` で使用可能
- AR 関連の特殊なスタイル（全画面表示、カメラビューなど）も `@theme` で定義

### パフォーマンス

- 本番ビルド時に未使用クラスが自動削除される（v4 では設定不要）
- Vite が自動的に最適化を行うため、追加の設定は不要

## コード品質チェック

### TypeScript / JavaScript

- ESLint: `pnpm lint`
- 型チェック: `pnpm build` または `tsc -b`
- ビルド: `pnpm build`
- プレビュー: `pnpm preview`
- 開発サーバー: `pnpm dev`

## 環境構築メモ

- パッケージマネージャー: pnpm を使用
- 開発サーバー: Vite の開発サーバーを `pnpm dev` で起動
- Tailwind CSS: `tailwindcss`, `postcss`, `autoprefixer` をインストール済み
- HTTPS 必須: AR 機能を使用するため、本番環境では HTTPS 配信が必須
- カメラアクセス: ユーザーの明示的な許可が必要
- 対応ブラウザ: iOS Safari、Android Chrome を主要ターゲットとする

## コーディング原則

### 共通原則

- 自己説明的なコードを書く（変数名・関数名を明確に）
- 関数は単一責任の原則を守る
- ユーザー入力は必ず検証・サニタイズする
- async/await を使用し、コールバック地獄を避ける
- 環境変数で設定を管理する

### TypeScript/React

- `any` 型を避け、型安全性を確保する
- `var` ではなく `let/const` を使用
- useEffect/useCallback の依存配列を正確に指定
- リストレンダリング時は適切な `key` を付与
- コンポーネント名は PascalCase で統一
- Props の型定義を明確にする

### AR 機能実装

- MindAR と A-Frame の初期化は useEffect 内で行い、クリーンアップを確実に実装
- AR シーンのライフサイクル管理を適切に行う
- カメラストリームの開始・停止を適切に制御し、リソースリークを防ぐ
- エラーハンドリングを徹底し、ユーザーにわかりやすいエラーメッセージを表示

## コードレビュー指示

レビューコメントには以下のプレフィックスを使用：

- `[must]` - 必須修正（セキュリティ、バグ、重大な設計問題）
- `[recommend]` - 推奨修正（パフォーマンス、可読性の改善）
- `[nits]` - 軽微な指摘（コードスタイル、タイポ）

### 重点チェック項目

- パフォーマンス: フレームレート、メモリ使用量、リソースサイズ
- AR 機能の安定性: 認識精度、トラッキング継続性
- エラーハンドリング: カメラアクセス拒否、認識失敗、リソース読み込みエラー
- モバイル対応: タッチ操作の使いやすさ、画面サイズへの適応
- アクセシビリティ: 操作説明の明確さ、エラーメッセージの分かりやすさ
- DRY・SOLID 原則の遵守
- 非推奨 API の使用有無

## コミットメッセージ

- 日本語で記述
- Conventional Commit 形式を基本とする

例:

- `feat: AR看板の配置機能を追加`
- `fix: iOS Safari でのカメラ認識エラーを修正`
- `perf: 3D モデルの読み込みを最適化`
- `docs: AR 機能の実装ガイドを追加`

## その他の注意事項

### セキュリティ

- HTTPS 配信必須（カメラアクセスに必要）
- カメラアクセスはユーザー明示許可制
- CORS 設定を適正化
- XSS, CSRF などのクロスサイト攻撃対策

### ブラウザ対応

- iOS Safari と Android Chrome を主要ターゲット
- ブラウザ固有の不具合に注意（特に iOS Safari の仕様差）
- 非対応ブラウザ時のフォールバック案内を実装

### リソース管理

- ターゲット画像、3D モデル、テクスチャは `public/` ディレクトリに配置
- リソースは軽量化必須（推奨: 各ファイル 1〜3 MB 以下）
- CDN やオブジェクトストレージの活用を検討

### テスト

- 実機テスト必須（iOS / Android 各種端末）
- 異なる光源・角度・距離条件での認識率テスト
- キャプチャ機能の動作確認
- 低性能端末での動作確認
